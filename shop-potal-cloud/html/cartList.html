<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <title>我的购物车</title>

    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->

    <link href="../js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../js1/DataTables/DataTables-1.10.20/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../js/shop/css/webbase.css" />
    <link rel="stylesheet" type="text/css" href="../js/shop/css/pages-getOrderInfo.css" />
</head>

<body>
<div id="navDiv"></div>
<!--head-->
<div class="cart">
    <!--All goods-->
        <div class="col-md-12" id="bodyDiv">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">订单列表</h3>
                </div>
                <div class="panel-body">
                    <table id="orderTable" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th>选择</th>
                            <th>订单编号</th>
                            <th>订单总价格</th>
                            <th>订单中商品总数量</th>
                            <th>订单状态</th>
                            <th>订单创建时间</th>
                            <th>订单收件人名字</th>
                            <th>地址</th>
                            <th>电话</th>
                            <th>支付方式</th>
                            <th>当前会员</th>
                            <th>操作</th>
                        </tr>
                        </thead>

                        <tfoot>
                        <tr>
                            <th>选择</th>
                            <th>订单编号</th>
                            <th>订单总价格</th>
                            <th>订单中商品总数量</th>
                            <th>订单状态</th>
                            <th>订单创建时间</th>
                            <th>订单收件人名字</th>
                            <th>地址</th>
                            <th>电话</th>
                            <th>支付方式</th>
                            <th>当前会员</th>
                            <th>操作</th>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
<!-- 底部栏位 -->


<!--页面底部-->
<div class="clearfix footer ">
    <div class="py-container">
        <div class="footlink">
            <div class="Mod-service">
                <ul class="Mod-Service-list">
                    <li class="grid-service-item intro  intro1">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item  intro intro2">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item intro  intro3">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item  intro intro4">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item intro intro5">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                </ul>
            </div>
            <div class="clearfix Mod-list">
                <div class="yui3-g">
                    <div class="yui3-u-1-6">
                        <h4>购物指南</h4>
                        <ul class="unstyled">
                            <li>购物流程</li>
                            <li>会员介绍</li>
                            <li>生活旅行/团购</li>
                            <li>常见问题</li>
                            <li>购物指南</li>
                        </ul>

                    </div>
                    <div class="yui3-u-1-6">
                        <h4>配送方式</h4>
                        <ul class="unstyled">
                            <li>上门自提</li>
                            <li>211限时达</li>
                            <li>配送服务查询</li>
                            <li>配送费收取标准</li>
                            <li>海外配送</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>支付方式</h4>
                        <ul class="unstyled">
                            <li>货到付款</li>
                            <li>在线支付</li>
                            <li>分期付款</li>
                            <li>邮局汇款</li>
                            <li>公司转账</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>售后服务</h4>
                        <ul class="unstyled">
                            <li>售后政策</li>
                            <li>价格保护</li>
                            <li>退款说明</li>
                            <li>返修/退换货</li>
                            <li>取消订单</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>特色服务</h4>
                        <ul class="unstyled">
                            <li>夺宝岛</li>
                            <li>DIY装机</li>
                            <li>延保服务</li>
                            <li>品优购E卡</li>
                            <li>品优购通信</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>帮助中心</h4>
                    </div>
                </div>
            </div>
            <div class="Mod-copyright">
                <ul class="helpLink">
                    <li>关于我们<span class="space"></span></li>
                    <li>联系我们<span class="space"></span></li>
                    <li>关于我们<span class="space"></span></li>
                    <li>商家入驻<span class="space"></span></li>
                    <li>营销中心<span class="space"></span></li>
                    <li>友情链接<span class="space"></span></li>
                    <li>关于我们<span class="space"></span></li>
                    <li>营销中心<span class="space"></span></li>
                    <li>友情链接<span class="space"></span></li>
                    <li>关于我们</li>
                </ul>
                <p>地址：郑州市福元路和英协路交叉口，华悦时间广场</p>
            </div>
        </div>
    </div>
</div>
<!--页面底部END-->
<script type="text/javascript" src="../js1/shop/js/plugins/jquery/jquery.min.js"></script>
<script src="../js/bootstrap/js/bootstrap.min.js"></script>
<script src="../js1/DataTables/DataTables-1.10.20/js/jquery.dataTables.min.js"></script>
<script src="../js1/DataTables/DataTables-1.10.20/js/dataTables.bootstrap.min.js"></script>
<script src="../js/bootbox/bootbox.min.js"></script>
<script src="../js/bootbox/bootbox.locales.min.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script type="text/javascript" src="../js/jquery.cookie.min.js"></script>
<script>
    //初始化函数
    $(function () {
        initOrderTable();
    });

    var v_cartTable;
    function initOrderTable() {
        //列表展示
        v_cartTable=$('#orderTable').DataTable({
            "language": {
                "url": "../js1/DataTables/Chinese.json" // 汉化
            },
            // 是否允许检索
            "searching": false,
            "processing": true,
            "lengthMenu": [5,10,15,20],
            "serverSide": true,
            "ajax": {
                "url": server_url+"/order/queruOrder",
                "type": "POST",
                beforeSend:function(xhr){
                    var auth=$.cookie("token");
                    xhr.setRequestHeader("x-auth",auth);
                }
            },
            "columns": [
                {  "data": "id",
                    "render": function (data, type, row, meta) {
                      /*  area=data;
                        console.log(area)*/
                        return '<input type="checkbox" name="ids" value="'+data+'"/>';
                    }
                },
                { "data": "id"},
                { "data": "totalPrice" },
                { "data": "totalCount" },
                { "data": "status" ,
                    "render": function (data, type, row, meta) {
                        if (data==0){
                            return "未支付"
                        }else if(data==40){
                            return "订单已取消"
                        }else if(data==10){
                            return "订单已支付"
                        }
                    }
                },
                { "data": "createTime" },
                { "data": "recipientName" },
                { "data": "recipientAddr" },
                { "data": "recipientPhone" },
                { "data": "payType" },
                { "data": "memberName" },
                { "data": "id" ,
                    "render": function (data, type, row, meta) {
                        return '<div class="btn-group" role="group">' +
                            '<a href="#" onclick="deleteOrder(\''+data+'\')">取消订单</a>/' +
                            '<a href="#" onclick="apiPay(\''+data+'\')">支付</a>' +
                            '</div>';
                    }
                }
            ]
        });
    }

    function apiPay(id) {
        console.log(id)
        $.ajax({
            type:"POST",
            url:server_url+"/pay/apipay",
            data:{"orderId":id},
            beforeSend:function(xhr){
                var auth=$.cookie("token");
                xhr.setRequestHeader("x-auth",auth);
            },
            success:function (result) {
                if (result.code==200){
                    var date=result.data;
                  $("body").html(date)

                }
            }
        })
    }









    function search() {
        v_cartTable.ajax.reload();
    }

    function deleteOrder(id) {
        console.log(id)
        $.ajax({
            type:"POST",
            url:server_url+"/order/deleteOrder/"+id,
            //data:{"id":id},
            beforeSend:function(xhr){
                var auth=$.cookie("token");
                xhr.setRequestHeader("x-auth",auth);
            },
            success:function (result) {
                if (result.code==200){
                    search();
                }
            }
        })
    }
</script>
</body>

</html>